
import streamlit as st
import pandas as pd

st.set_page_config(page_title="Pedi QuikCalc Clone", layout="centered")
st.title("حاسبة NICU المتقدمة للأطفال")

# إدخال الوزن
الوزن = st.number_input("الوزن (بالغرام):", min_value=0.0, step=1.0)

# قائمة الأدوية مع الفئات والجرعات لكل كجم ولون لكل فئة
أدوية = {
    "أموكسيسيلين": {"جرعة":25, "فئة":"مضاد حيوي", "لون":"#ffcccc"},
    "جنتاميسين": {"جرعة":4, "فئة":"مضاد حيوي", "لون":"#ffcccc"},
    "فلوكونازول": {"جرعة":6, "فئة":"مضاد فطري", "لون":"#ccccff"},
    "فينوباربيتال": {"جرعة":15, "فئة":"مهدئ/مضاد اختلاج", "لون":"#ffffcc"},
    "باراسيتامول": {"جرعة":10, "فئة":"مسكن/خافض حرارة", "لون":"#ffccff"},
    "إيبوبروفين": {"جرعة":10, "فئة":"مسكن/خافض حرارة", "لون":"#ffccff"},
    "دوكسيسايكلين": {"جرعة":2, "فئة":"مضاد حيوي", "لون":"#ffcccc"},
    "أمينوفيلين": {"جرعة":5, "فئة":"أدوية القلب/الرئة", "لون":"#ccffcc"},
    "ميثيل دوبا": {"جرعة":7, "فئة":"أدوية القلب/ضغط الدم", "لون":"#ccffcc"},
    "ريدونوكس": {"جرعة":3, "فئة":"أدوية القلب/ضغط الدم", "لون":"#ccffcc"}
}

# تصنيف الأدوية حسب الفئة
فئات = sorted(list(set([info["فئة"] for info in أدوية.values()])))
فئة_مختارة = st.selectbox("اختر فئة الدواء:", ["كل الفئات"] + فئات)

# فلترة الأدوية حسب الفئة
if فئة_مختارة == "كل الفئات":
    أدوية_مفلترة = list(أدوية.keys())
else:
    أدوية_مفلترة = [دواء for دواء, info in أدوية.items() if info["فئة"] == فئة_مختارة]

# اختيار الأدوية من الفئة
أدوية_مختارة = st.multiselect("اختر الأدوية:", أدوية_مفلترة)

# حساب الجرعات وعرضها
if st.button("احسب الجرعات"):
    if الوزن <= 0:
        st.warning("الرجاء إدخال الوزن أولاً")
    elif not أدوية_مختارة:
        st.warning("الرجاء اختيار دواء واحد على الأقل")
    else:
        # إنشاء جدول للنتائج
        بيانات = []
        for دواء in أدوية_مختارة:
            جرعة = الوزن * أدوية[دواء]["جرعة"]
            بيانات.append({"الدواء": دواء, "الجرعة (mg)": round(جرعة,1), "الفئة": أدوية[دواء]["فئة"]})
        df = pd.DataFrame(بيانات)
        # عرض الجدول مع ألوان حسب الفئة
        def color_row(row):
            return ['background-color: {}'.format(أدوية[row["الدواء"]]["لون"])]*len(row)
        st.dataframe(df.style.apply(color_row, axis=1))